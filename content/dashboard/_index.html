---
title: "Dashboard"
date: 2024-02-19T19:30:09-05:00
draft: false
---
<!-- <!DOCTYPE html> -->
<head>

</head>

<body>

    <p>Current situation as of <b>Jan 16, 2024</b></p>

    <div id="scalarReportsTableDiv" style="display: block">
        <h2>Reported events</h2>

        <table id="scalarReportsTable">
            <thead>
                <tr>
                    <th>Event</th>
                    <th>Counts</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Hospitalizations</td>
                    <td>23</td>
                </tr>
                <tr>
                    <td>Deaths</td>
                    <td>2</td>
                </tr>
            </tbody>
          </table> 
    
    </div>
    
    <div id="plotsMainDiv" style="display: block">
        <h2>Visualizations</h2>

        <!-- Message line for website errors -->
        <div><p id="statusMessage" style="color: chocolate;"></p></div>

        <!-- <p id="TEST">   </p> -->

        <button id="refreshButton" class="btn cstyle interactive primary" 
        style="padding: 16px 32px;font-size: 16px;">
            Refresh data
        </button>

        <!-- PLOT DIVS -->
        <div id="weeklyPlots" style="text-align: center; height: 500px; display: block">
            <h3>Weekly Time Series</h3>
        </div>
        <div id="dailyPlots" style="text-align: center; height: 500px; display: block">
            <h3>Daily Time Series</h3>
            <!-- <div id="dailyPlots"></div> -->
        </div>
        <div id="testPlot" style="text-align: center; height: 500px"></div>

    </div>
<!-- ======================================== -->
<!--  CUSTOM SCRIPTS  -->


<script src={{< mybaseurl "js/plotly-2.29.1.min.js" >}} charset="utf-8"></script>

<script id="init">
    // Code to run on page load

    console.log("Hello, World!");



    // ============================================
    // ATTEMPT TO FETCH DATA FROM GCLOUD
    // ============================================

    async function load_json_data(_url){
        console.group("load_json_data")
        console.log(`Fetching data from ${_url}`)
        
        let response;
        try {
            response = await fetch(_url, {cache: "reload"});
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            console.log("response = ", response);
        } catch (error) {
            console.error("Failed to fetch data:", error);
            document.getElementById("statusMessage").innerHTML = `Failed to fetch data: ${error}`
            console.groupEnd();
            // return null; // or throw the error, or handle it in another appropriate way
            throw error;
        }

        console.log("Parsing response as json");
        let obj;
        try {
            obj = JSON.parse(await response.text());
        } catch (error) {
            console.error("Failed to parse response as JSON:", error);
            console.groupEnd();
            return null; // or throw the error, or handle it in another appropriate way
        }
        
        console.log("obj = ", obj);
        console.groupEnd();
        
        return obj;
    }


    // ---------------------------------------------------
    // PLOTLY
    // ---------------------------------------------------

    async function plot_all_json_data(data_obj){
        console.group("plot_all_json_data")

        // ============================
        // General plot setup
        // ============================
        var plotlyConfig = {
            responsive: true,
            modeBarButtonsToRemove: ["select2d", "lasso2d"],
        };

        var plotlyLayout = {
            showlegend: true,
            legend: {
                x: 0.02,
                xanchor: 'left',
                y: 1
            },
                font: {
                // family: 'Courier New, monospace',
                // size: 18,
                color: '#808080'
            },
            margin: { t: 100, b: 50, l: 50, r: 50 },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            colorway : ['#7dc903', '#282828', '#3f6502', '#a8a8a8']
        };


        // ============================
        // Weekly Plots
        // ============================
        var weeklyPlots = document.getElementById("weeklyPlots");

        // Get elements of `data_obj` that start with "weekly_", push each one into an array
        const weeklyData = Object
            .keys(data_obj)
            .filter(key => key.startsWith("weekly_"))
            .map(key => data_obj[key]);
        console.log("weeklyData = ", weeklyData);

        // Create an inherited layout for the weekly plots
        var weeklyLayout = {
            ...plotlyLayout,
            // title: 'Weekly Time Series',
            // xaxis:{gridcolor: '#80808040'},
            yaxis:{gridcolor: '#80808040'},
        }; 

        Plotly.newPlot(
            weeklyPlots,
            weeklyData,
            weeklyLayout,
            plotlyConfig
        )
        console.log("Weekly plots done")


        // ============================
        // Daily Plots
        // ============================
        var dailyPlots = document.getElementById("dailyPlots");
        
        // Get elements of `data_obj` that start with "daily_", push each one into an array
        const dailyData = Object
            .keys(data_obj)
            .filter(key => key.startsWith("daily_"))
            .filter(key => key.endsWith("_data"))
            .map(key => data_obj[key]);
        console.log("dailyData = ", dailyData);

        // Create an inherited layout for the daily plots
        var dailyLayout = {
            ...plotlyLayout,
            // title: 'Daily Time Series',
            xaxis:{gridcolor: '#80808040'},
            yaxis:{gridcolor: '#80808040'}
        };

        Plotly.newPlot(
            dailyPlots,
            dailyData,
            dailyLayout,
            plotlyConfig
        );
        console.log("Daily plots done")
        
        // // ============================
        // // Test Plot
        // // ============================
        // var testPlot = document.getElementById("testPlot");

        // // --- Traces
        // var mybars = {
        //     type: "bar",
        //     visible: true,
        //     x: [1, 2, 3, 4, 5],
        //     y: [1, 2, 4, 8, 12] 
        // }

        // // // --- Layout
        // // var layout = {
        // //     title: 'simple example',
        // //     // margin: { t: 0 } 
        // // }

        // // // --- Configuration
        // // var config = {
        // //     responsive: true
        // // }

        // Plotly.newPlot( 
        //     testPlot, 
        //     [mybars], 
        //     plotlyLayout,
        //     plotlyConfig
        // );

        console.log("Plot done")
        console.groupEnd()
    }

    
    // load_json_data("/plot_data.json")  // Works only locally
    load_json_data({{< mybaseurl "plot_data.json" >}})
        .then(plot_all_json_data)



</script>


</body>